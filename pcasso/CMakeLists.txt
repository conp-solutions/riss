# Project definitions
# 
project(pcasso)

# 
# Libraries
#
# special case - this is an autogenerated file
set(VERSION_CC ${CMAKE_CURRENT_SOURCE_DIR}/version.cc)
set(LIB_SOURCES
    LevelPool.cc
    LookaheadSplitting.cc
    Master.cc
    PartitionTree.cc
    SolverPT.cc
    SolverRiss.cc
    SolverPriss.cc
    shared_pool.cc
    vsidsSplitting.cc
    PcassoComConfig.cc
    ${VERSION_CC})

add_library(pcasso-lib-static STATIC ${LIB_SOURCES})
add_library(pcasso-lib-shared SHARED ${LIB_SOURCES})

set_target_properties(pcasso-lib-static PROPERTIES
                                        OUTPUT_NAME "pcasso"
                                        COMPILE_FLAGS "-DPCASSO")
set_target_properties(pcasso-lib-shared PROPERTIES
                                        OUTPUT_NAME "pcasso" 
                                        COMPILE_FLAGS "-DPCASSO"
                                        VERSION ${VERSION}
                                        SOVERSION ${SOVERSION})

git_signature(PROJECT_NAME pcasso
              SCRIPT ${CMAKE_CURRENT_SOURCE_DIR}/version.cmake
              DESTINATION ${VERSION_CC})

# 
# Executables
# 
add_executable(pcasso Main.cc)

if(CLASSIFIER)
  set_target_properties(pcasso PROPERTIES COMPILE_FLAGS "-DPCASSO -DCLASSIFIER")
else()
  set_target_properties(pcasso PROPERTIES COMPILE_FLAGS "-DPCASSO")
endif()

# 
# Note:
#   pcasso uses a specific preprocessor flag. All used libraries has
#   to be build with this flag, except they are completly independent
#   of the solver toolchain (e.g. libpca)
# 
if(STATIC_BINARIES)
  # Damn circular dependecies! We have to specify riss library twice,
  # because libriss needs libcoprcessor and libcorpcessor needs libriss :/
  target_link_libraries(pcasso pcasso-lib-static
                               pfolio-pcasso-lib-static
                               riss-pcasso-lib-static
                               coprocessor-pcasso-lib-static
                               riss-pcasso-lib-static)
  if(CLASSIFIER)
    target_link_libraries(pcasso classifier-pcasso-lib-static libpca-static)
  endif()
else()
  target_link_libraries(pcasso pcasso-lib-shared
                               riss-pcasso-lib-shared
                               pfolio-pcasso-lib-shared
                               coprocessor-pcasso-lib-shared)
  if(CLASSIFIER)
    target_link_libraries(pcasso classifier-pcasso-lib-shared libpca-shared)
  endif()
endif()

# 
# Installation
# 
install(TARGETS pcasso-lib-static pcasso-lib-shared pcasso
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)

install(DIRECTORY pcasso
        DESTINATION include/pcasso
        FILES_MATCHING PATTERN "*.h")
