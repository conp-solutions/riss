# Project definitions
# 
project(coprocessor)

# 
# Libraries
# 
# special case - this is an autogenerated file
set(VERSION_CC ${CMAKE_CURRENT_SOURCE_DIR}/version.cc)
set(LIB_SOURCES
    CP3Config.cc
    Circuit.cc
    Coprocessor.cc
    OutputFormula.cc
    Shuffler.cc
    libcoprocessorc.cc
    # all techniques
    techniques/BVE.cc
    techniques/BVEParallel.cc
    techniques/BVA.cc    
    techniques/ClauseElimination.cc
    techniques/Dense.cc
    techniques/Entailed.cc
    techniques/EquivalenceElimination.cc
    techniques/Experimental.cc
    techniques/FourierMotzkin.cc
    techniques/HiddenTautologyElimination.cc
    techniques/LiteralAddition.cc
    techniques/ModPrep.cc
    techniques/Probing.cc
    techniques/Propagation.cc
    techniques/Resolving.cc
    techniques/Rewriter.cc
    techniques/Subsumption.cc
    techniques/Symmetry.cc
    techniques/Unhiding.cc
    techniques/BCE.cc
    techniques/RATE.cc
    techniques/HBR.cc
    techniques/SLS.cc
    techniques/Xor.cc
    ${VERSION_CC})

add_library(coprocessor-lib-static STATIC ${LIB_SOURCES})
add_library(coprocessor-lib-shared SHARED ${LIB_SOURCES})
add_library(coprocessor-lib-object OBJECT ${LIB_SOURCES})

# This extra libraries are build for pcasso, because pcasso needs some
# extensions to the riss source code
add_library(coprocessor-pcasso-lib-static STATIC ${LIB_SOURCES})
add_library(coprocessor-pcasso-lib-shared SHARED ${LIB_SOURCES})

set_target_properties(coprocessor-lib-static PROPERTIES
                                             OUTPUT_NAME "coprocessor")
set_target_properties(coprocessor-lib-shared PROPERTIES
                                             OUTPUT_NAME "coprocessor" 
                                             VERSION ${VERSION}
                                             SOVERSION ${SOVERSION})
set_target_properties(coprocessor-pcasso-lib-static PROPERTIES
                                                    OUTPUT_NAME "coprocessor-pcasso"
                                                    COMPILE_FLAGS "-DPCASSO")
set_target_properties(coprocessor-pcasso-lib-shared PROPERTIES
                                                    OUTPUT_NAME "coprocessor-pcasso" 
                                                    VERSION ${VERSION}
                                                    SOVERSION ${SOVERSION}
                                                    COMPILE_FLAGS "-DPCASSO")

target_link_libraries(coprocessor-lib-static riss-lib-static)
git_signature(PROJECT_NAME "coprocessor"
              SCRIPT ${CMAKE_CURRENT_SOURCE_DIR}/version.cmake
              DESTINATION ${VERSION_CC}
              VERSION ${VERSION})

# 
# Executables
# 
add_executable(coprocessor Main.cc)

if(STATIC_BINARIES)
  target_link_libraries(coprocessor riss-lib-static coprocessor-lib-static)
else()
  target_link_libraries(coprocessor riss-lib-shared coprocessor-lib-shared)
endif()

# Installation:
# 
# Installation
# 
install(TARGETS coprocessor-lib-static coprocessor-lib-shared coprocessor-pcasso-lib-static coprocessor-pcasso-lib-shared coprocessor
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)

install(DIRECTORY coprocessor
        DESTINATION include/coprocessor
        FILES_MATCHING PATTERN "*.h")
