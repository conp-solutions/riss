# Project definitions
# 
project(coprocessor)
version("3.0.0")

# 
# Libraries
# 
# special case - this is an autogenerated file
set(VERSION_CC ${CMAKE_CURRENT_SOURCE_DIR}/version.cc)
set(LIB_SOURCES
    BoundedVariableElimination.cc
    BoundedVariableEliminationParallel.cc
    Bva.cc
    CP3Config.cc
    Circuit.cc
    ClauseElimination.cc
    Coprocessor.cc
    Dense.cc
    Entailed.cc
    EquivalenceElimination.cc
    Experimental.cc
    FourierMotzkin.cc
    HiddenTautologyElimination.cc
    LiteralAddition.cc
    OutputFormula.cc
    Probing.cc
    Propagation.cc
    Resolving.cc
    Rewriter.cc
    Shuffler.cc
    Subsumption.cc
    Symmetry.cc
    TwoSAT.cc
    Unhiding.cc
    bce.cc
    libcoprocessorc.cc
    rate.cc
    sls.cc
    xor.cc
    ${VERSION_CC})

add_library(coprocessor-lib-static STATIC ${LIB_SOURCES})
add_library(coprocessor-lib-shared SHARED ${LIB_SOURCES})
add_library(coprocessor-lib-object OBJECT ${LIB_SOURCES})

# This extra libraries are build for pcasso, because pcasso needs some
# extensions to the riss source code
add_library(coprocessor-pcasso-lib-static STATIC ${LIB_SOURCES})
add_library(coprocessor-pcasso-lib-shared SHARED ${LIB_SOURCES})

set_target_properties(coprocessor-lib-static PROPERTIES
                                             OUTPUT_NAME "coprocessor")
set_target_properties(coprocessor-lib-shared PROPERTIES
                                             OUTPUT_NAME "coprocessor" 
                                             VERSION ${VERSION}
                                             SOVERSION ${SOVERSION})
set_target_properties(coprocessor-pcasso-lib-static PROPERTIES
                                                    OUTPUT_NAME "coprocessor-pcasso"
                                                    COMPILE_FLAGS "-DPCASSO")
set_target_properties(coprocessor-pcasso-lib-shared PROPERTIES
                                                    OUTPUT_NAME "coprocessor-pcasso" 
                                                    VERSION ${VERSION}
                                                    SOVERSION ${SOVERSION}
                                                    COMPILE_FLAGS "-DPCASSO")

git_signature(PROJECT_NAME "coprocessor"
              SCRIPT ${CMAKE_CURRENT_SOURCE_DIR}/version.cmake
              DESTINATION ${VERSION_CC}
              VERSION ${VERSION})

# 
# Executables
# 
add_executable(coprocessor Main.cc)

if(STATIC_BINARIES)
  target_link_libraries(coprocessor riss-lib-static coprocessor-lib-static)
else()
  target_link_libraries(coprocessor riss-lib-shared coprocessor-lib-shared)
endif()

# 
# Installation
# 
install(TARGETS coprocessor-lib-static coprocessor-lib-shared coprocessor-pcasso-lib-static coprocessor-pcasso-lib-shared coprocessor
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)

install(DIRECTORY coprocessor
        DESTINATION include/coprocessor
        FILES_MATCHING PATTERN "*.h")
